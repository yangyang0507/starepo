# Starepo 开发计划 - Agentic AI 工具驱动架构

> 基于 AI Agent + Tool Calling 的智能 GitHub Star 管理系统

## 🎯 总体目标

构建一个**基于 Agentic AI 的 GitHub Star 智能管理工具**，让 AI Agent 自主调用各种搜索、筛选、分析工具，帮助用户通过自然语言快速找到需要的项目。

**核心差异化**：

- ❌ 不使用向量搜索/Embedding
- ✅ 使用 AI Agent + 工具链
- ✅ 透明、可解释、精确可控

---

## 📋 开发阶段规划

### Phase 1: 数据层基础设施 (Week 1-2) 🏗️

#### 1.1 本地数据存储设计与实现

**目标**：建立稳定的本地数据存储系统

**任务清单**：

- [ ] **数据库选型与配置**
  - [ ] 设计配置系统（支持 JSON 和 SQLite 两种模式）
  - [ ] 实现 JSON 存储引擎（`src/main/services/database/json-storage.ts`）
  - [ ] 实现 SQLite 存储引擎（`src/main/services/database/sqlite-storage.ts`）
  - [ ] 创建统一的数据库接口抽象层（`src/main/services/database/database-interface.ts`）

- [ ] **数据模型定义**
  - [ ] 定义 Repository Schema（`src/shared/types/repository.ts`）
  - [ ] 定义 User Schema（`src/shared/types/user.ts`）
  - [ ] 定义 Metadata Schema（tags, notes）
  - [ ] 使用 Zod 创建运行时验证 Schema

- [ ] **索引和查询优化**
  - [ ] SQLite 索引设计（language, stars, updatedAt, name）
  - [ ] SQLite FTS5 全文搜索表创建
  - [ ] JSON 存储的内存索引实现
  - [ ] 查询性能基准测试

- [ ] **数据迁移系统**
  - [ ] 版本管理机制
  - [ ] 自动迁移脚本
  - [ ] 数据备份和恢复

**验收标准**：

- ✅ 可以存储和查询 Repository 数据
- ✅ 支持全文搜索
- ✅ 支持按多个字段筛选和排序
- ✅ 性能测试通过（10k 条数据查询 < 100ms）

---

#### 1.2 GitHub API 集成与数据同步

**目标**：完整的 GitHub 数据获取和同步能力

**任务清单**：

- [ ] **GitHub API 客户端**
  - [ ] Octokit.js 集成配置
  - [ ] 认证管理（Personal Access Token）
  - [ ] Rate Limiting 监控和处理
  - [ ] 错误处理和重试机制

- [ ] **数据获取功能**
  - [ ] 获取用户 Star 列表（分页处理）
  - [ ] 获取单个仓库详情
  - [ ] 获取 README 内容
  - [ ] 批量获取仓库信息（GraphQL API）

- [ ] **同步策略实现**
  - [ ] 首次完整同步
  - [ ] 增量同步（基于 starredAt 时间戳）
  - [ ] 后台定时同步（可配置）
  - [ ] 同步状态管理和进度展示

- [ ] **数据一致性保障**
  - [ ] 本地与远程数据对比
  - [ ] 冲突解决策略
  - [ ] 数据完整性校验

**验收标准**：

- ✅ 可以完整同步用户的 Star 列表
- ✅ 增量同步正常工作
- ✅ Rate Limiting 正确处理
- ✅ 网络错误自动重试

---

#### 1.3 测试覆盖

- [ ] 数据库操作单元测试
- [ ] GitHub API 集成测试（Mock）
- [ ] 同步流程集成测试
- [ ] 性能测试和基准

**完成标准**：

- 测试覆盖率 > 70%
- 所有核心功能有测试

---

### Phase 2: AI Agent 核心系统 (Week 3-4) 🤖

#### 2.1 AI SDK 集成与配置

**目标**：建立 AI Agent 核心能力

**任务清单**：

- [ ] **AI SDK V5 集成**
  - [ ] 安装和配置 AI SDK
  - [ ] 多 Provider 支持（OpenAI, Anthropic, Google）
  - [ ] API Key 管理和验证
  - [ ] 模型选择和配置

- [ ] **AI Agent 核心实现**（`src/main/services/ai/agent.ts`）
  - [ ] Agent 类设计和实现
  - [ ] 基础对话能力（generateText）
  - [ ] 流式响应能力（streamText）
  - [ ] 上下文管理（多轮对话）
  - [ ] Token 使用统计

- [ ] **错误处理和降级**
  - [ ] API 调用失败处理
  - [ ] Rate Limiting 处理
  - [ ] 超时和重试机制
  - [ ] 降级策略（如切换到备用 Provider）

**验收标准**：

- ✅ 可以通过 AI SDK 调用各种 AI Provider
- ✅ 流式响应正常工作
- ✅ 多轮对话上下文正确维护
- ✅ 错误处理健壮

---

#### 2.2 工具注册表系统

**目标**：建立工具定义、注册、调用的完整机制

**任务清单**：

- [ ] **Tool Registry 实现**（`src/main/services/ai/tool-registry.ts`）
  - [ ] 工具注册接口
  - [ ] 工具查询接口
  - [ ] 工具参数验证（Zod Schema）
  - [ ] 工具执行代理

- [ ] **Tool Calling 集成**
  - [ ] AI SDK Tool Calling 配置
  - [ ] 工具调用结果处理
  - [ ] 多步工具调用支持（maxSteps）
  - [ ] 工具调用日志和监控

- [ ] **工具元数据管理**
  - [ ] 工具描述和文档
  - [ ] 工具分类和标签
  - [ ] 工具使用统计

**验收标准**：

- ✅ 可以注册和查询工具
- ✅ AI Agent 可以正确调用工具
- ✅ 工具参数验证正常工作
- ✅ 支持多步工具调用

---

#### 2.3 IPC 通信层

**目标**：渲染进程与 AI Agent 的通信

**任务清单**：

- [ ] **AI IPC Channels 定义**
  - [ ] `AI:CHAT` - 发送消息
  - [ ] `AI:CHAT_STREAM` - 流式响应
  - [ ] `AI:GET_TOOLS` - 获取可用工具列表
  - [ ] `AI:GET_STATS` - 获取使用统计

- [ ] **IPC Handlers 实现**（`src/main/ipc/ai-handlers.ts`）
  - [ ] 消息处理
  - [ ] 流式响应处理
  - [ ] 错误处理和返回

- [ ] **渲染进程 API 封装**（`src/renderer/api/ai.ts`）
  - [ ] `sendMessage()`
  - [ ] `streamMessage()`
  - [ ] `getTools()`
  - [ ] `getStats()`

**验收标准**：

- ✅ 渲染进程可以发送消息给 AI Agent
- ✅ 流式响应正确传递到渲染进程
- ✅ 错误处理正确

---

#### 2.4 测试覆盖

- [ ] AI Agent 单元测试
- [ ] Tool Registry 单元测试
- [ ] IPC 通信集成测试
- [ ] 完整对话流程 E2E 测试

**完成标准**：

- 测试覆盖率 > 70%
- AI 核心功能稳定可靠

---

### Phase 3: 搜索与分析工具集 (Week 5-6) 🔍

#### 3.1 搜索工具实现

**目标**：实现所有搜索和筛选工具

**任务清单**：

- [ ] **`searchByKeyword`** - 关键词搜索
  - [ ] 在 name, description, readme 中搜索
  - [ ] 支持多个搜索范围组合
  - [ ] 结果排序优化（相关度）
- [ ] **`filterByLanguage`** - 语言筛选
  - [ ] 支持单个或多个语言
  - [ ] 语言标准化处理
- [ ] **`filterByStars`** - Star 数筛选
  - [ ] 支持 min/max 范围
  - [ ] 支持开区间
- [ ] **`filterByDate`** - 日期筛选
  - [ ] 按创建时间筛选
  - [ ] 按更新时间筛选
  - [ ] 支持相对时间（如"最近30天"）
- [ ] **`searchByTopic`** - 主题搜索
  - [ ] 支持多个 topic 组合
  - [ ] Topic 标准化处理
- [ ] **`searchInReadme`** - README 全文搜索
  - [ ] 使用 SQLite FTS5 或内存搜索
  - [ ] 支持高亮匹配内容

**文件位置**：`src/main/services/tools/search-tools.ts`

**验收标准**：

- ✅ 每个工具独立测试通过
- ✅ AI Agent 可以正确调用这些工具
- ✅ 工具可以组合使用（AI 自动编排）

---

#### 3.2 分析工具实现

**目标**：实现数据分析和统计工具

**任务清单**：

- [ ] **`analyzeLanguageDistribution`** - 语言分布统计
  - [ ] 统计每种语言的项目数
  - [ ] 计算百分比
  - [ ] 可视化数据格式化
- [ ] **`findTrendingRepos`** - 热门项目发现
  - [ ] 基于 Star 增长速度排序
  - [ ] 支持时间范围参数（如最近30天）
  - [ ] 返回趋势指标
- [ ] **`compareRepos`** - 项目对比
  - [ ] 对比多个项目的关键指标
  - [ ] 支持自定义对比维度
  - [ ] 生成对比报告

- [ ] **`getRepoStats`** - 项目统计
  - [ ] 总 Star 数统计
  - [ ] 语言分布
  - [ ] 活跃度分析
  - [ ] 时间趋势分析

**文件位置**：`src/main/services/tools/analysis-tools.ts`

**验收标准**：

- ✅ 分析工具返回准确数据
- ✅ 性能满足要求（< 200ms）
- ✅ AI 可以正确解释分析结果

---

#### 3.3 GitHub 操作工具

**目标**：实现 GitHub 实时操作工具

**任务清单**：

- [ ] **`getRepoDetails`** - 获取项目详情
  - [ ] 从 GitHub API 实时获取
  - [ ] 缓存优化
- [ ] **`starRepo`** / **`unstarRepo`** - Star 操作
  - [ ] 调用 GitHub API
  - [ ] 本地数据同步更新
- [ ] **`syncStars`** - 手动同步
  - [ ] 触发增量同步
  - [ ] 返回同步进度和结果

**文件位置**：`src/main/services/tools/github-tools.ts`

**验收标准**：

- ✅ GitHub 操作成功执行
- ✅ 本地数据与远程同步
- ✅ 错误处理健壮

---

#### 3.4 工具注册与测试

- [ ] 所有工具注册到 Tool Registry
- [ ] 单元测试（每个工具独立测试）
- [ ] 集成测试（AI Agent 调用工具）
- [ ] 性能测试（大数据量）

**完成标准**：

- 所有工具测试覆盖率 > 80%
- AI Agent 可以流畅使用所有工具

---

### Phase 4: 聊天界面与交互 (Week 7-8) 💬

#### 4.1 聊天界面实现

**目标**：构建友好的对话式用户界面

**任务清单**：

- [ ] **Chat 页面布局**（`src/renderer/pages/chat/index.tsx`）
  - [ ] 消息列表展示区
  - [ ] 输入框和发送按钮
  - [ ] 侧边栏（工具列表、历史对话）
- [ ] **消息组件**（`src/renderer/components/chat/`）
  - [ ] `MessageBubble` - 消息气泡
  - [ ] `UserMessage` - 用户消息
  - [ ] `AIMessage` - AI 回复
  - [ ] `ToolCallDisplay` - 工具调用展示
  - [ ] `LoadingIndicator` - 加载状态
- [ ] **输入组件**
  - [ ] `ChatInput` - 输入框
  - [ ] 快捷键支持（Enter 发送，Shift+Enter 换行）
  - [ ] 自动高度调整
  - [ ] 输入建议（可选）

**验收标准**：

- ✅ 界面美观易用
- ✅ 响应式设计（适配不同窗口大小）
- ✅ 交互流畅

---

#### 4.2 流式响应展示

**目标**：实时展示 AI 生成过程

**任务清单**：

- [ ] **流式数据处理**（`src/renderer/hooks/useAIChat.ts`）
  - [ ] 接收 IPC 流式数据
  - [ ] 增量更新消息内容
  - [ ] 处理工具调用事件
- [ ] **打字机效果**
  - [ ] 逐字显示 AI 回复
  - [ ] 可中断和跳过
- [ ] **流式错误处理**
  - [ ] 网络中断提示
  - [ ] 重试机制

**验收标准**：

- ✅ 流式响应实时展示
- ✅ 无卡顿和延迟
- ✅ 错误处理友好

---

#### 4.3 工具调用可视化

**目标**：让用户看到 AI 的工作过程

**任务清单**：

- [ ] **工具调用卡片**（`src/renderer/components/chat/tool-call-card.tsx`）
  - [ ] 显示工具名称和描述
  - [ ] 显示工具参数
  - [ ] 显示工具执行结果
  - [ ] 可折叠/展开
- [ ] **工具调用时间线**
  - [ ] 显示多步工具调用顺序
  - [ ] 执行时间统计
- [ ] **样式和动画**
  - [ ] 工具调用动画效果
  - [ ] 成功/失败状态指示

**验收标准**：

- ✅ 工具调用过程清晰可见
- ✅ 用户可以理解 AI 的决策过程
- ✅ 样式美观

---

#### 4.4 搜索结果展示

**目标**：优雅展示搜索到的项目

**任务清单**：

- [ ] **Repository 卡片**（`src/renderer/components/repo/repo-card.tsx`）
  - [ ] 项目名称、描述
  - [ ] 语言、Star 数、Fork 数
  - [ ] 主题标签
  - [ ] 操作按钮（Star/Unstar, 查看详情）
- [ ] **搜索结果列表**
  - [ ] 虚拟滚动优化（大量结果）
  - [ ] 排序选项
  - [ ] 分页或无限滚动
- [ ] **详情弹窗**
  - [ ] README 预览
  - [ ] 完整项目信息
  - [ ] 外部链接

**验收标准**：

- ✅ 搜索结果清晰展示
- ✅ 大量结果性能良好
- ✅ 交互友好

---

#### 4.5 对话历史和管理

**目标**：保存和管理对话记录

**任务清单**：

- [ ] **对话存储**（`src/main/services/database/conversation-storage.ts`）
  - [ ] 保存对话历史到本地
  - [ ] 支持搜索历史对话
- [ ] **历史侧边栏**（`src/renderer/components/chat/history-sidebar.tsx`）
  - [ ] 对话列表
  - [ ] 删除和重命名对话
  - [ ] 搜索对话
- [ ] **上下文管理**
  - [ ] 保存完整对话上下文
  - [ ] 导入/导出对话

**验收标准**：

- ✅ 对话历史正确保存和加载
- ✅ 历史管理功能完善
- ✅ 性能良好

---

#### 4.6 测试覆盖

- [ ] 组件单元测试
- [ ] 交互测试（用户点击、输入）
- [ ] 流式响应测试
- [ ] E2E 测试（完整对话流程）

**完成标准**：

- 测试覆盖率 > 70%
- 所有交互正常工作

---

### Phase 5: 高级功能与优化 (Week 9-10) ✨

#### 5.1 用户标签和笔记系统

**任务清单**：

- [ ] 为项目添加自定义标签
- [ ] 为项目添加个人笔记
- [ ] 按标签筛选项目
- [ ] 标签管理界面

---

#### 5.2 数据导出和备份

**任务清单**：

- [ ] 导出数据为 JSON
- [ ] 导出数据为 CSV
- [ ] 数据备份功能
- [ ] 数据恢复功能

---

#### 5.3 自定义工具扩展

**任务清单**：

- [ ] 定义工具扩展接口
- [ ] 工具热加载机制
- [ ] 示例自定义工具
- [ ] 文档和教程

---

#### 5.4 性能优化

**任务清单**：

- [ ] 数据库查询优化
- [ ] UI 渲染优化
- [ ] 内存使用优化
- [ ] 启动速度优化

---

#### 5.5 用户体验优化

**任务清单**：

- [ ] 快捷键支持
- [ ] 主题切换优化
- [ ] 国际化（中英文）
- [ ] 可访问性优化

---

### Phase 6: 测试、文档与发布 (Week 11-12) 🚀

#### 6.1 完整测试

- [ ] 所有功能的集成测试
- [ ] 性能压力测试
- [ ] 跨平台测试（macOS, Windows, Linux）
- [ ] 用户验收测试（UAT）

---

#### 6.2 文档完善

- [ ] 用户使用手册
- [ ] 开发者文档
- [ ] API 文档
- [ ] 贡献指南

---

#### 6.3 发布准备

- [ ] 版本号管理
- [ ] 更新日志
- [ ] 打包和分发
- [ ] GitHub Release

---

## 🎯 里程碑（Milestones）

| 里程碑                | 目标                       | 预计完成时间 | 关键指标                     |
| --------------------- | -------------------------- | ------------ | ---------------------------- |
| **M1: 数据层就绪**    | 完成数据存储和 GitHub 同步 | Week 2       | ✅ 可以同步并存储 Star 数据  |
| **M2: AI Agent 可用** | AI Agent 核心功能完成      | Week 4       | ✅ 可以通过 AI 对话调用工具  |
| **M3: 工具集完整**    | 所有搜索和分析工具实现     | Week 6       | ✅ AI 可以完成复杂的多步查询 |
| **M4: MVP 发布**      | 聊天界面完成，可以发布 MVP | Week 8       | ✅ 用户可以通过对话查找项目  |
| **M5: 功能完善**      | 高级功能和优化完成         | Week 10      | ✅ 用户体验流畅，性能良好    |
| **M6: 正式发布**      | 测试和文档完成，正式发布   | Week 12      | ✅ v1.0.0 发布               |

---

## 📊 工作量评估

| Phase                      | 预计工作量（天） | 复杂度 | 优先级 |
| -------------------------- | ---------------- | ------ | ------ |
| Phase 1: 数据层基础设施    | 10-12            | 中     | P0     |
| Phase 2: AI Agent 核心系统 | 10-12            | 高     | P0     |
| Phase 3: 搜索与分析工具集  | 10-12            | 中     | P0     |
| Phase 4: 聊天界面与交互    | 10-12            | 中     | P0     |
| Phase 5: 高级功能与优化    | 8-10             | 低     | P1     |
| Phase 6: 测试、文档与发布  | 8-10             | 低     | P1     |
| **总计**                   | **56-68 天**     | -      | -      |

---

## 🚧 风险管理

| 风险                     | 影响 | 应对策略                     |
| ------------------------ | ---- | ---------------------------- |
| AI SDK 不稳定            | 高   | 提前充分测试，准备降级方案   |
| GitHub API Rate Limiting | 中   | 实现智能缓存和增量同步       |
| 工具调用不准确           | 高   | 优化工具描述，增加示例和文档 |
| 性能问题（大量数据）     | 中   | 提前性能测试，优化数据库查询 |
| 跨平台兼容性             | 低   | 持续在多平台测试             |

---

## 🎨 UI/UX 设计原则

1. **简洁优先**：界面清爽，避免信息过载
2. **对话式交互**：以对话为核心，隐藏复杂度
3. **透明可解释**：展示 AI 的工作过程和决策依据
4. **响应式设计**：适配不同窗口大小
5. **暗黑模式支持**：保护用户眼睛

---

## 📈 成功指标

### 技术指标

- ✅ 测试覆盖率 > 70%
- ✅ 所有 LSP Diagnostics 无错误
- ✅ 数据库查询性能 < 100ms（10k 数据）
- ✅ AI 响应时间 < 3s（首 token）
- ✅ 内存占用 < 200MB（空闲状态）

### 用户体验指标

- ✅ AI 理解准确率 > 90%
- ✅ 工具调用成功率 > 95%
- ✅ 界面响应时间 < 100ms
- ✅ 崩溃率 < 0.1%

---

## 🤝 团队协作

### 开发流程

1. **需求分析** → 确认功能需求和技术方案
2. **设计评审** → 代码设计和架构评审
3. **开发实现** → 按 Phase 分阶段开发
4. **代码审查** → 每个 PR 必须经过 Review
5. **测试验收** → 功能测试和性能测试
6. **文档更新** → 同步更新文档

### Git 工作流

- `main` - 主分支，稳定版本
- `develop` - 开发分支，最新代码
- `feature/xxx` - 功能分支
- `fix/xxx` - 修复分支

### Commit 规范

- `feat:` - 新功能
- `fix:` - 修复 Bug
- `refactor:` - 重构
- `test:` - 测试相关
- `docs:` - 文档更新
- `chore:` - 构建和工具相关

---

## 📚 相关文档

- [架构设计文档](./agentic-ai-architecture.md)
- [测试指南](./TESTING.md)
- [AGENTS 开发指南](../AGENTS.md)
- [README](../README.md)

---

**文档版本：** v1.0  
**最后更新：** 2025-01-07  
**负责人：** Starepo Team
