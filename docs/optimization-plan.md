# Starepo 项目优化计划

## 背景

当前项目已完成 Electron 多进程架构、IPC 通道及基础 UI 框架搭建，但在向量数据库、认证链路和类型定义等领域仍存在若干结构性问题。以下计划旨在梳理高价值优化项，帮助团队按优先级推进迭代，并在执行过程中同步改进工程质量和开发体验。

## 总体目标

- 建立可靠的 LanceDB 数据管线，确保语义检索真实可用。
- 强化认证流程的可靠性与可维护性，避免状态反复初始化。
- 消除跨层类型不一致、潜在安全风险，提升代码一致性。
- 完善用户首屏体验与国际化基础，构建持续迭代的良好基础设施。

## 优先级列表

### 高优先级（需要优先排期）

1. **向量检索体系落地**
   - 在 `LanceDBService` 中接入真实嵌入生成流程，替换当前的全零向量。
   - 使用 LanceDB 的参数化查询或 SQL 绑定，避免 `whereClause` 直接拼接导致的注入风险。
   - 统一封装 LanceDB 日志与错误处理，确保生产环境可控。

2. **认证链路稳定化**
   - 为 `EnhancedGitHubAuthService` 增加缓存控制，避免 `getAuthState()` 每次触发网络请求。
   - 拆分 “验证 Token” 与 “登录” 两种 IPC 行为，渲染层 `validateToken()` 不再调用 `authenticateWithToken()`。
   - 结合速率限制信息制定重试/降级策略，并补充对应的 E2E 或集成测试。

3. **类型与数据模型统一**
   - 将 `src/main/services/github/types.ts` 与 `@shared/types` 中的重复 GitHub 类型合并，主进程依赖共享定义。
   - 对齐 `SearchResult` 在 shared 与 database 模块中的字段命名（`items` vs `repos`），同步更新使用方。

### 中优先级（高优事项完成后推进）

1. **搜索服务性能优化**
   - 在 `LanceDBSearchService` 中减少重复的数据库往返，将语言、star 区间等过滤条件合并到单次查询。
   - 依据数据量设计分页与结果缓存策略，确保渲染侧响应稳定。

2. **状态持久化补齐**
   - 为主题、语言等设置提供持久化（可借助 `secureStorage` 或 JSON 文件），保证多次启动一致体验。
   - 在初始化流程中引入回退默认值和异常日志。

3. **日志与监控基线**
   - 将大量 `console.log` 替换为带分级的日志工具，并按环境开关。
   - 记录关键操作（数据库初始化、认证刷新）的成功与失败指标，为后续监控铺路。

### 低优先级（迭代期逐步落实）

1. **开发体验与规范**
   - 拆分 ESLint 配置，分别为主进程启用 `globals.node`、渲染进程启用 `globals.browser`，减少误报警。
   - 整理 `docs/` 与 `README`，补充开发流程、测试策略说明。

2. **国际化与 UI 细节**
   - 将首页等组件中的硬编码中文迁移到 i18n 资源文件，保障中英文一致性。
   - 审视 `window.electronAPI` 暴露的未实现方法，改为抛出明确错误或暂时下线，避免误用。

3. **测试与自动化**
   - 为 LanceDB 数据写入、检索和认证状态流转补充单元/集成测试。
   - 持续运行 `npm run lint`、`npm test` 在 CI 中验证改动，防止回归。

## 建议执行节奏

1. **第一周**：完成 LanceDB 与认证链路的核心修复，确保搜索与登录流程可靠；同时梳理统一类型定义。
2. **第二周**：针对搜索性能、设置持久化展开重构；补充关键路径测试。
3. **第三周及之后**：处理低优先级事项，逐步完善国际化、日志与文档，确保团队迭代效率。

以上计划可根据实际资源、需求优先级动态调整，但建议优先完成高优事项，以解除功能可用性与安全隐患。若执行中发现阻塞（如嵌入生成依赖外部服务），请及时记录在文档并同步团队。
